{% extends "base.html" %}
{% load static %}

{% block title %}Levantamento de Salário{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<div class="saque-page-white">
    <div class="saque-wrapper">
        
        <div class="top-header-clean">
            <a href="{% url 'perfil' %}" class="btn-back-dark">
                <i class="fas fa-arrow-left"></i>
            </a>
            <h1 class="header-title-clean">Salário</h1>
            <div style="width: 24px;"></div> 
        </div>

        <div class="multicaixa-card">
            <div class="mc-chip"></div>
            <div class="mc-brand">MULTICAIXA</div>
            <div class="mc-label">Saldo Disponível</div>
            <div class="mc-balance">{{ request.user.available_balance|default:"0,00" }} <small>KZ</small></div>
            <div class="mc-footer">
                <span class="mc-holder">SISTEMA VIP</span>
                <span class="mc-symbol"><i class="fas fa-signal"></i></span>
            </div>
        </div>

        <div class="form-container-clean">
            {# Mensagens Django #}
            {% if messages %}
                <div class="messages-container">
                    {% for message in messages %}
                        <div class="msg-alert {{ message.tags }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}

            <form method="post" id="form-saque" class="saque-form">
                {% csrf_token %}
                
                <div class="method-section">
                    <label class="section-label">Forma de Levantamento</label>
                    <div class="method-grid">
                        <label class="method-option">
                            <input type="radio" name="withdrawal_method" value="BANCO" required onclick="toggleFields('banco')">
                            <div class="method-box">
                                <i class="fas fa-university"></i>
                                <span>BANCO</span>
                            </div>
                        </label>
                        <label class="method-option">
                            <input type="radio" name="withdrawal_method" value="PIX" onclick="toggleFields('pix')">
                            <div class="method-box">
                                <i class="fas fa-bolt"></i>
                                <span>PIX</span>
                            </div>
                        </label>
                        <label class="method-option">
                            <input type="radio" name="withdrawal_method" value="USDT" onclick="toggleFields('usdt')">
                            <div class="method-box">
                                <i class="fas fa-coins"></i>
                                <span>USDT</span>
                            </div>
                        </label>
                    </div>
                </div>

                <div id="fields-container" class="fields-card" style="display: none;">
                    <div id="field-banco" class="method-fields" style="display: none;">
                        <input type="text" name="bank_name" placeholder="Nome do Banco" class="premium-input">
                        <input type="text" name="iban" placeholder="IBAN (AO06...)" class="premium-input">
                        <input type="text" name="account_holder" placeholder="Titular da Conta" class="premium-input">
                    </div>

                    <div id="field-pix" class="method-fields" style="display: none;">
                        <input type="text" name="pix_key" placeholder="Chave PIX (CPF, E-mail, Celular)" class="premium-input">
                    </div>

                    <div id="field-usdt" class="method-fields" style="display: none;">
                        <input type="text" name="usdt_address" placeholder="Endereço Carteira (Rede TRC20)" class="premium-input">
                    </div>
                </div>

                <div class="amount-display-box">
                    <label>Valor Selecionado</label>
                    <div class="input-wrapper-premium">
                        <span class="currency-prefix">KZ</span>
                        <input type="number" name="amount" id="id_amount" readonly required placeholder="0">
                    </div>
                </div>

                <div class="quick-values-pill-grid">
                    <button type="button" class="pill-btn" onclick="setAmount(3000)">3000</button>
                    <button type="button" class="pill-btn" onclick="setAmount(8000)">8000</button>
                    <button type="button" class="pill-btn" onclick="setAmount(15000)">15000</button>
                    <button type="button" class="pill-btn" onclick="setAmount(50000)">50.000</button>
                    <button type="button" class="pill-btn" onclick="setAmount(100000)">100.000</button>
                    <button type="button" class="pill-btn" onclick="setAmount(180000)">180.000</button>
                    <button type="button" class="pill-btn" onclick="setAmount(280000)">280.000</button>
                    <button type="button" class="pill-btn" onclick="setAmount(500000)">500.000</button>
                </div>

                <button type="submit" class="btn-confirm-premium">
                    EFETUAR LEVANTAMENTO
                </button>
            </form>
        </div>
    </div>
</div>

<style>
    /* Estilos de Estrutura e Reset */
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { margin: 0; padding: 0; overflow-x: hidden; background: #fff; }
    .saque-page-white { background-color: #ffffff; min-height: 100vh; width: 100%; display: flex; justify-content: center; font-family: 'Segoe UI', sans-serif; }
    .saque-wrapper { width: 100%; max-width: 400px; padding: 20px; display: flex; flex-direction: column; }

    /* Header */
    .top-header-clean { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
    .btn-back-dark { color: #1a1a1a; font-size: 1.3rem; }
    .header-title-clean { font-size: 1.25rem; font-weight: 700; color: #1a1a1a; margin: 0; }

    /* Cartão Multicaixa */
    .multicaixa-card {
        background: linear-gradient(135deg, #004488 0%, #0066cc 100%);
        width: 100%; aspect-ratio: 1.6 / 1; border-radius: 16px; padding: 20px;
        color: white; position: relative; box-shadow: 0 8px 20px rgba(0, 70, 140, 0.2); margin-bottom: 25px;
    }
    .mc-chip { width: 40px; height: 30px; background: linear-gradient(135deg, #f1c40f 0%, #d4ac0d 100%); border-radius: 4px; }
    .mc-brand { position: absolute; top: 20px; right: 20px; font-weight: 800; font-size: 0.9rem; }
    .mc-balance { font-size: 1.8rem; font-weight: 700; margin-top: 10px; }
    .mc-footer { position: absolute; bottom: 20px; left: 20px; right: 20px; display: flex; justify-content: space-between; font-size: 0.75rem; opacity: 0.9; }

    /* Métodos de Pagamento */
    .section-label { font-size: 0.85rem; font-weight: 700; color: #666; display: block; margin-bottom: 12px; text-align: center; }
    .method-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
    .method-option { cursor: pointer; }
    .method-option input { display: none; }
    .method-box {
        background: #f8f9fa; border: 1px solid #eee; border-radius: 12px; padding: 12px 5px;
        display: flex; flex-direction: column; align-items: center; gap: 8px; transition: 0.3s;
    }
    .method-box i { font-size: 1.2rem; color: #444; }
    .method-box span { font-size: 0.7rem; font-weight: 700; }
    .method-option input:checked + .method-box { background: #eef6ff; border-color: #0066cc; transform: translateY(-3px); box-shadow: 0 4px 10px rgba(0,102,204,0.1); }
    .method-option input:checked + .method-box i { color: #0066cc; }

    /* Campos Dinâmicos */
    .fields-card { background: #fdfdfd; border: 1px dashed #ccd6e0; border-radius: 12px; padding: 15px; margin-bottom: 20px; }
    .premium-input {
        width: 100%; background: #fff; border: 1px solid #e0e0e0; border-radius: 8px;
        padding: 12px; font-size: 0.9rem; margin-bottom: 10px; outline: none; transition: 0.3s;
    }
    .premium-input:focus { border-color: #0066cc; box-shadow: 0 0 0 3px rgba(0,102,204,0.05); }

    /* Valores e Botões */
    .amount-display-box { text-align: center; margin-bottom: 20px; }
    .input-wrapper-premium { display: flex; align-items: center; justify-content: center; border-bottom: 2px solid #0066cc; max-width: 180px; margin: 0 auto; }
    .currency-prefix { font-size: 1.1rem; font-weight: 800; color: #0066cc; margin-right: 5px; }
    .input-wrapper-premium input { border: none; background: transparent; font-size: 1.8rem; font-weight: 700; color: #1a1a1a; width: 100%; outline: none; text-align: center; }

    .quick-values-pill-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 25px; }
    .pill-btn { background: #f2f4f7; border: 1px solid #eef0f2; padding: 10px 2px; border-radius: 10px; font-size: 0.75rem; font-weight: 700; cursor: pointer; }
    .pill-btn:active { background: #0066cc; color: white; }

    .btn-confirm-premium {
        width: 100%; background: #0066cc; color: white; border: none; padding: 16px;
        border-radius: 12px; font-size: 0.95rem; font-weight: 700; cursor: pointer; box-shadow: 0 6px 15px rgba(0,102,204,0.2);
    }
    .msg-alert { padding: 10px; border-radius: 8px; text-align: center; margin-bottom: 10px; font-size: 0.85rem; }
    .msg-alert.success { background: #e8f5e9; color: #2e7d32; }
</style>

<script>
    function toggleFields(method) {
        document.getElementById('fields-container').style.display = 'block';
        // Esconder todos os grupos primeiro
        document.querySelectorAll('.method-fields').forEach(el => {
            el.style.display = 'none';
            // Remover 'required' dos inputs escondidos para não travar o envio
            el.querySelectorAll('input').forEach(input => input.required = false);
        });

        // Mostrar o selecionado e adicionar 'required'
        const activeGroup = document.getElementById('field-' + method);
        activeGroup.style.display = 'block';
        activeGroup.querySelectorAll('input').forEach(input => input.required = true);
    }

    function setAmount(val) {
        const input = document.getElementById('id_amount');
        if (input) {
            input.value = val;
            const wrapper = document.querySelector('.input-wrapper-premium');
            wrapper.style.borderBottomColor = '#27ae60';
            setTimeout(() => { wrapper.style.borderBottomColor = '#0066cc'; }, 400);
        }
    }
</script>
{% endblock %}
